# Лендинг студии дизайна интерьеров Анны Пакселевой

## Репозиторий

**GitHub:** https://github.com/pakartem94/AnnaPakseleva

## Общее описание

Одностраничный продающий лендинг для студии дизайна интерьеров в Калининграде. Цель — привести пользователя к первому контакту (консультация или расчёт стоимости).

## Структура проекта

```
AnnaPakseleva/
├── index.php           # Основная страница
├── privacy.php         # Политика конфиденциальности
├── css/
│   ├── style.css       # Основные стили (BEM, CSS-переменные)
│   ├── tablet.css      # Стили для планшетов (768px-1199px)
│   └── mobile.css      # Стили для мобильных устройств (max-width: 767px)
├── js/
│   ├── main.js         # Основной JavaScript функционал
│   ├── reviews.js      # Загрузка отзывов из БД
│   ├── tablet.js       # JavaScript для планшетов
│   └── mobile.js       # JavaScript для мобильных устройств
├── api/
│   ├── send.php        # Обработчик форм
│   ├── reviews.php     # API для получения отзывов
│   └── db-schema.sql   # Схема базы данных
├── admin/              # Админ-панель
│   ├── config.php      # Конфигурация БД и функции
│   ├── login.php       # Страница входа
│   ├── dashboard.php   # Главная страница админки
│   ├── reviews.php     # Управление отзывами
│   ├── portfolio.php   # Управление портфолио
│   ├── leads.php       # CRM для заявок
│   ├── sidebar.php     # Боковое меню
│   ├── admin.css       # Стили админки
│   ├── admin.js        # JavaScript админки
│   └── api/
│       ├── reviews.php # API управления отзывами
│       ├── portfolio.php # API управления портфолио
│       └── leads.php   # API управления заявками
├── img/
│   ├── logo.PNG        # Логотип
│   ├── photo_*.webp    # Фото для секций
│   └── portfolio/      # Портфолио
│       ├── 1/          # Проект 1 (45 изображений)
│       ├── 2/          # Проект 2 (74 изображения)
│       └── 3/          # Проект 3 (45 изображений)
├── logs/               # Логи заявок (создаётся автоматически)
├── md/
│   └── cursor.md       # Документация
└── tz/
    └── tz.txt          # Техническое задание
```

## Технологии

- **HTML5** — семантическая разметка
- **CSS3** — BEM-методология, CSS-переменные, адаптивная вёрстка
- **JavaScript** — Vanilla JS, без библиотек
- **PHP** — обработка форм, отправка email, админ-панель
- **MySQL** — база данных для отзывов, портфолио и заявок

## Админ-панель

### Доступ

Админ-панель доступна по адресу: `/admin/`

**Дефолтные учётные данные:**
- Логин: `admin`
- Пароль: `admin123`

⚠️ **Важно:** После первого входа обязательно смените пароль!

### Функционал

1. **Управление отзывами** (`/admin/reviews.php`)
   - Добавление новых отзывов
   - Редактирование существующих
   - Удаление отзывов
   - Управление порядком сортировки
   - Публикация/скрытие отзывов

2. **Управление портфолио** (`/admin/portfolio.php`)
   - Добавление проектов
   - Редактирование проектов
   - Удаление проектов
   - Сортировка проектов
   - Активация/деактивация проектов

3. **CRM для заявок** (`/admin/leads.php`)
   - Просмотр всех заявок с сайта
   - Фильтрация по статусам (новые, связались, в работе, завершены, отклонены)
   - Изменение статуса заявки
   - Добавление заметок к заявкам
   - Удаление заявок

4. **Смена пароля** (`/admin/change-password.php`)
   - Смена пароля администратора
   - Проверка текущего пароля
   - Минимальная длина нового пароля — 6 символов
   - Подтверждение нового пароля

### База данных

Для работы админ-панели необходимо выполнить SQL-скрипт `api/db-schema.sql`, который создаст следующие таблицы:

- `leads` — заявки с сайта
- `reviews` — отзывы клиентов
- `portfolio_projects` — проекты портфолио
- `admins` — администраторы

### Email-уведомления

Все заявки с сайта автоматически отправляются на email `ann-ki@mail.ru` с адреса `no-reply@studioap.ru`.

## CSS-переменные

Все цвета и отступы определены в `:root` в `css/style.css`:

### Цвета
- `--color-bg-main` — основной фон (#E5DDD4)
- `--color-bg-dark` — тёмный фон (#1F2938)
- `--color-primary` — винно-бордовый (#5A1D33)
- `--color-accent-blue` — пыльно-голубой (#8EA4B8)
- `--color-highlight-gold` — золотой акцент (#D3B46A)

### Типографика
- `--font-heading` — Cormorant Garamond (заголовки)
- `--font-sans` — Inter (основной текст)

## Секции лендинга

1. **Hero** — главный экран с CTA
2. **Services** — что входит в дизайн-проект (карточки с иконкой слева и текстом справа)
3. **Stages** — этапы работы (таймлайн)
4. **Tariffs** — 3 тарифа (Стандарт, Расширенный, Полный контроль)
5. **Portfolio** — галерея с табами по проектам
6. **Why Us** — преимущества студии
7. **Pains** — боли клиентов и решения
8. **Gifts** — подарки к проекту
9. **About** — о руководителе студии
10. **Reviews** — отзывы клиентов (загружаются из БД)
11. **FAQ** — аккордеон с вопросами
12. **Contact** — форма заявки и контакты

## Формы

### Основная форма (секция Contact)
Поля:
- Имя (обязательное)
- Телефон (обязательное, с маской)
- Тип объекта (select)
- Площадь (number)
- Этап (select)
- Комментарий (textarea)
- Согласие с политикой конфиденциальности (чекбокс, обязательное)

### Модальная форма
Открывается по кнопкам "Консультация" и "Выбрать тариф".
Автозаполнение поля тарифа при выборе из секции Tariffs.
Содержит чекбокс согласия с политикой конфиденциальности (обязательное).

### Защита
- Honeypot-поле (скрытое)
- Проверка согласия с политикой конфиденциальности
- Возможность подключения reCAPTCHA (код готов)

## JavaScript функционал

### Основной функционал (`js/main.js`)
- **Sticky header** — при скролле
- **Мобильное меню** — бургер
- **Модальные окна** — с анимацией
- **Маска телефона** — +7 (___) ___-__-__
- **FAQ аккордеон** — раскрывающиеся ответы
- **Портфолио** — табы, lazy loading, lightbox
- **Scroll-анимации** — fade-in при появлении
- **Smooth scroll** — плавная прокрутка к якорям

### Загрузка отзывов (`js/reviews.js`)
- Автоматическая загрузка отзывов из БД при загрузке страницы
- Отображение первых 4 отзывов
- Кнопка "Показать ещё" для загрузки остальных
- Плавная анимация появления новых отзывов

### Планшетный функционал (`js/tablet.js`)
- **Touch-события** — оптимизация свайпов в lightbox
- **Адаптация портфолио** — оптимизация для планшетов
- **Lazy loading** — улучшенная загрузка изображений с приоритетом

### Мобильный функционал (`js/mobile.js`)
- **Touch-события** — оптимизация свайпов в lightbox и портфолио
- **Адаптация портфолио** — сетка 2 колонки для мобильных
- **Оптимизация меню** — улучшенная работа мобильного меню
- **Оптимизация форм** — предотвращение zoom на iOS, улучшенная работа с клавиатурой
- **Производительность** — оптимизация для мобильных устройств, поддержка reduced-motion
- **Lazy loading** — улучшенная загрузка изображений с увеличенным rootMargin

## API

### POST /api/send.php

Отправка формы.

**Параметры:**
- `name` — имя (обязательно)
- `phone` — телефон (обязательно)
- `privacy_agree` — согласие с политикой конфиденциальности (обязательно)
- `form_type` — тип формы (consultation/tariff)
- `tariff` — выбранный тариф
- `object_type` — тип объекта
- `area` — площадь
- `stage` — этап
- `comment` — комментарий
- `utm_*` — UTM-метки

**Ответ:**
```json
{
  "success": true,
  "message": "Заявка успешно отправлена"
}
```

### GET /api/reviews.php

Получение опубликованных отзывов для главной страницы.

**Ответ:**
```json
[
  {
    "id": 1,
    "name": "Имя клиента",
    "project": "Квартира 85 м²",
    "text": "Текст отзыва",
    "rating": 5,
    "avatar_initials": "ИК",
    "is_published": 1,
    "sort_order": 0
  }
]
```

## Адаптивные брейкпоинты

- **Desktop** — ≥1200px (основной CSS)
- **Tablet** — 768–1199px (отдельные файлы `css/tablet.css` и `js/tablet.js`)
- **Mobile** — <768px (отдельные файлы `css/mobile.css` и `js/mobile.js`)

## Настройка

### Email
В файле `api/send.php` настроены:
- `email_to` — `ann-ki@mail.ru`
- `email_from` — `no-reply@studioap.ru`

### База данных
1. Создайте БД и выполните `api/db-schema.sql`
2. Настройте параметры подключения в `admin/config.php` и `api/send.php`

### Яндекс.Метрика
Яндекс.Метрика установлена на всех страницах сайта (`index.php` и `privacy.php`).

**ID счётчика:** `105649801`

**Настройки:**
- SSR (Server-Side Rendering) — включено
- Вебвизор — включён
- Карта кликов — включена
- E-commerce — через dataLayer
- Точный показатель отказов — включён
- Отслеживание внешних ссылок — включено

Код метрики размещён перед закрывающим тегом `</body>` на всех страницах.

## Секция отзывов

Отзывы загружаются динамически из базы данных через API `/api/reviews.php`. 

В админ-панели можно:
- Добавлять новые отзывы
- Редактировать существующие
- Управлять порядком отображения (поле `sort_order`)
- Публиковать/скрывать отзывы

Изначально показываются первые 4 отзыва, остальные скрыты. Кнопка "Показать ещё" загружает по 4 отзыва за раз с плавной анимацией появления.

Каждая карточка содержит:
- Аватар с инициалами (генерируется автоматически)
- Имя клиента
- Тип и площадь проекта
- Рейтинг (1-5 звёзд)
- Текст отзыва

## Аналитика (готово к подключению)

События для отслеживания:
- `form_submit` — отправка формы
- `whatsapp` — клик WhatsApp
- `telegram` — клик Telegram
- `phone_click` — клик по телефону

## Исправления

### Восстановление главной страницы
- Восстановлен `js/main.js` из git (файл был пустым)
- Исправлена секция отзывов: добавлен `id="reviewsGrid"` для динамической загрузки отзывов из БД
- Добавлено подключение `js/reviews.js` в `index.php`
- Удалены статические отзывы из HTML (теперь загружаются динамически через API)

### Замена домена
- Заменён домен `https://annapakseleva.ru` на `https://studioap.ru` во всех файлах:
  - `index.php` — мета-теги, Open Graph, Twitter Card, Schema.org
  - `robots.txt` — sitemap URL
  - `sitemap.xml` — все URL страниц и изображений

### Подготовка отзывов к продакшену
- Очищен код от отладочных `console.log` и избыточных проверок
- Упрощена структура JavaScript — код приведён к единому стилю с портфолио
- Используются простые inline-обработчики `onclick` для кнопок
- Модальное окно управляется через CSS-класс `modal--hidden`
- Убраны избыточные стили с `!important`, оставлены только необходимые
- Код готов к продакшену

### Портфолио из админ-панели
- Создан публичный API `/api/portfolio.php` для получения проектов и изображений
- Портфолио на главной странице загружается динамически из базы данных
- Табы проектов создаются автоматически на основе активных проектов из БД
- Убрано поле "Номер папки" — проекты идентифицируются по ID
- Добавлена массовая загрузка изображений webP с разбивкой на части (по 20 файлов)
- Реализована сортировка изображений через drag & drop в админ-панели
- При удалении проекта удаляются все файлы изображений
- Изображения сохраняются в `img/portfolio/{project_id}/`
- Поддержка мобильной версии обновлена для работы с новой структурой данных

### Слайдер табов портфолио
- Добавлен слайдер для заголовков проектов в секции портфолио
- Автоматическая прокрутка активного таба в видимую область при клике
- На мобильных устройствах табы прокручиваются горизонтально свайпом
- На десктопе табы отображаются с переносом строк
- Плавная прокрутка при переключении табов
- Адаптивный дизайн для десктопа и мобильных устройств

## Подготовка к продакшену

### Исправления безопасности

#### 1. Устранение дублирования конфигурации БД
- Убрана дублирующая конфигурация БД из `api/send.php` и `api/reviews.php`
- Теперь используется общий конфиг `admin/config.php` через `require_once`
- Упрощена поддержка и снижен риск рассинхронизации настроек

#### 2. Защита от SQL Injection
- ✅ Все запросы используют prepared statements (PDO)
- ✅ Параметры передаются через `execute()` с массивом значений
- ✅ Нет прямой конкатенации пользовательских данных в SQL

#### 3. Защита от XSS
- ✅ Все пользовательские данные экранируются через `htmlspecialchars()`
- ✅ Функция `sanitize()` используется во всех формах
- ✅ Добавлены заголовки безопасности в `admin/config.php`:
  - `X-Content-Type-Options: nosniff`
  - `X-Frame-Options: SAMEORIGIN`
  - `X-XSS-Protection: 1; mode=block`

#### 4. Защита от CSRF
- ✅ Honeypot-поле в формах для защиты от ботов
- ⚠️ Для полной защиты рекомендуется добавить CSRF-токены (опционально)

#### 5. Rate Limiting
- ✅ Добавлена базовая защита от спама в `api/send.php`
- ✅ Ограничение: максимум 5 запросов в минуту с одного IP
- ✅ Используется файловая система для хранения счётчиков
- ✅ Автоматическая очистка старых записей

#### 6. Безопасность файлов
- ✅ Исправлены права доступа к папкам: `0777` → `0755`
- ✅ Права на логи: `0750` для папки, `0640` для файлов
- ✅ Защита папки `logs/` через `.htaccess` (полный запрет доступа)
- ✅ Валидация размера загружаемых файлов (максимум 10MB)
- ✅ Проверка MIME-типа загружаемых изображений (только webp)

#### 7. Обработка ошибок
- ✅ Детали ошибок не раскрываются пользователям
- ✅ Все ошибки логируются через `error_log()`
- ✅ Унифицированные сообщения об ошибках в API
- ✅ Защита от раскрытия информации о структуре БД

#### 8. Безопасность сессий
- ✅ Настроены безопасные параметры сессий:
  - `session.cookie_httponly = 1` (защита от XSS)
  - `session.use_strict_mode = 1` (защита от фиксации сессии)
  - `session.cookie_secure = 0` (установить в 1 при использовании HTTPS)

#### 9. Защита конфигурационных файлов
- ✅ `.htaccess` защищает `config.php` от прямого доступа
- ✅ Защита файлов `.htaccess`, `.sql`, `.log`, `.md` от просмотра
- ✅ Запрет листинга директорий (`Options -Indexes`)

### Рекомендации перед публикацией

#### Обязательные действия:
1. **Сменить дефолтный пароль администратора** через `/admin/change-password.php`
2. **Настроить HTTPS** и установить `session.cookie_secure = 1` в `admin/config.php`
3. **Проверить права доступа** к файлам и папкам на сервере:
   - Папки: `755` или `750`
   - PHP файлы: `644`
   - Конфиги: `600` (если возможно)
4. **Настроить бэкапы БД** (рекомендуется ежедневно)
5. **Проверить работу email-уведомлений** на реальном сервере

#### Опциональные улучшения:
1. **Добавить CSRF-токены** для форм (повышенная безопасность)
2. **Настроить более продвинутый rate limiting** на уровне веб-сервера (nginx/Apache)
3. **Добавить мониторинг** ошибок (Sentry, Rollbar и т.д.)
4. **Настроить WAF** (Web Application Firewall) на уровне сервера
5. **Добавить логирование** всех действий администратора

### Проверка перед публикацией

#### Чек-лист безопасности:
- [x] Все SQL-запросы используют prepared statements
- [x] Все пользовательские данные экранируются
- [x] Права доступа к файлам настроены корректно
- [x] Конфигурационные файлы защищены от прямого доступа
- [x] Ошибки не раскрывают чувствительную информацию
- [x] Rate limiting настроен для API
- [x] Валидация загружаемых файлов работает
- [x] Honeypot-защита в формах активна
- [ ] HTTPS настроен (проверить на сервере)
- [ ] Дефолтный пароль изменён (выполнить после публикации)

#### Производительность:
- [x] Изображения оптимизированы (webp формат)
- [x] Lazy loading для изображений
- [x] Минификация CSS/JS (опционально, можно добавить)
- [x] Кэширование статических ресурсов (настроить на сервере)

### Структура безопасности

```
AnnaPakseleva/
├── .htaccess              # Защита корневой директории
├── admin/
│   ├── .htaccess         # Защита админ-панели
│   ├── config.php        # Конфиг БД (защищён от прямого доступа)
│   └── api/              # API админки (требует авторизации)
├── api/
│   ├── .htaccess         # Защита публичного API
│   ├── send.php          # Rate limiting, валидация
│   └── reviews.php       # Публичный API отзывов
├── logs/
│   └── .htaccess         # Полный запрет доступа к логам
└── img/
    └── portfolio/        # Изображения (публичный доступ)
```

### Логирование

Все ошибки логируются в системный лог PHP через `error_log()`. Для продакшена рекомендуется:
- Настроить ротацию логов
- Мониторинг критических ошибок
- Регулярная проверка логов на подозрительную активность

### Резервное копирование

Рекомендуется настроить автоматическое резервное копирование:
- База данных (ежедневно)
- Загруженные изображения (еженедельно)
- Конфигурационные файлы (при изменении)

### Сброс пароля администратора

Для сброса или установки пароля администратора используется скрипт `/admin/reset-password.php`.

**КРИТИЧЕСКИ ВАЖНО:** Этот скрипт НЕ защищён паролем и должен быть удалён сразу после использования!

#### Использование:

1. Откройте в браузере: `/admin/reset-password.php`
2. Выберите пользователя из списка или введите имя вручную
3. Введите новый пароль (минимум 6 символов)
4. **НЕМЕДЛЕННО удалите файл `reset-password.php` после использования!**

#### Безопасность:

- ⚠️ Скрипт НЕ защищён паролем — доступен всем, кто знает URL
- Все действия логируются с IP-адресом
- Пароли хешируются через `password_hash()`
- **ОБЯЗАТЕЛЬНО удалите файл сразу после использования!**

#### Удаление файла:

```bash
# Через SSH/FTP удалите файл:
rm admin/reset-password.php
```

## Политика конфиденциальности

### Страница политики
Создана страница `privacy.php` с полным текстом политики обработки персональных данных в соответствии с требованиями ФЗ-152.

### Согласие с политикой
- Во всех формах добавлен обязательный чекбокс согласия с политикой конфиденциальности
- Чекбокс содержит ссылку на страницу политики (открывается в новой вкладке)
- Проверка согласия реализована на сервере в `api/send.php`
- Стили чекбокса добавлены в `css/style.css` (класс `.form__checkbox`)

### Ссылки на политику
- Футер главной страницы (`index.php`)
- Футер страницы политики (`privacy.php`)

## Контакты

### Telegram
Аккаунт Telegram: `@Anna_Pakseleva` (https://t.me/Anna_Pakseleva)

Ссылки на Telegram размещены в:
- Structured data (Schema.org) — поле `sameAs`
- Секция контактов — кнопка мессенджера
- Floating contact button — плавающая кнопка связи
